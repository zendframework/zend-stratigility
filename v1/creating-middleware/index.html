<!DOCTYPE html>
<html lang="en">


<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="zend-stratigility">  
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Creating Middleware - zend-stratigility</title>

    <link rel="stylesheet" href="../../css/styles-e95dab66f8.css">
</head>
<body id="page-top">

    
    <div class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">

            
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            
            <span class="navbar-brand">
                <a class="logo-link" href="https://framework.zend.com/" data-tooltip data-placement="bottom" title="Go to the ZF homepage">
                    <img src="../../img/zend-framework-logo.svg" height="28" alt="Zend Framework">
                </a>
            </span>
        </div>

        <div class="navbar-collapse collapse">

            
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="https://framework.zend.com/about">About</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/downloads">Install</a>
                </li>
                <li class="active">
                    <a href="https://docs.zendframework.com">Documentation</a>
                </li>
                <li>
                    <a href="https://www.zend.com/en/services/training">Training</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/blog">Blog</a>
                </li>
                <li>
                    <a href="https://framework.zend.com/participate">Participate</a>
                </li>
            </ul>

            
            
                <div class="nav navbar-nav navbar-collapse visible-xs-block ">
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">zend-stratigility</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            
                
                    <li class="subnavigation__list-item ">
                        <a href="../../v3/intro/" class="subnavigation__link">Intro</a>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">Reference</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/install/" class="subnavigation__link">Installation and Requirements</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/usage/" class="subnavigation__link">Usage</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/middleware/" class="subnavigation__link">Middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/error-handlers/" class="subnavigation__link">Error Handlers</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/creating-middleware/" class="subnavigation__link">Creating Middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/executing-middleware/" class="subnavigation__link">Composing middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/api/" class="subnavigation__link">API Reference</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/migration/" class="subnavigation__link">Migration</a>
    </li>

                            
                        </ul>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">v1</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item ">
        <a href="../install/" class="subnavigation__link">Installation and Requirements</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../usage/" class="subnavigation__link">Usage</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../middleware/" class="subnavigation__link">Middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../error-handlers/" class="subnavigation__link">Error Handlers</a>
    </li>

                            
                                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Creating Middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../executing-middleware/" class="subnavigation__link">Executing and composing middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../api/" class="subnavigation__link">API Reference</a>
    </li>

                            
                        </ul>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">v2</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/install/" class="subnavigation__link">Installation and Requirements</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/usage/" class="subnavigation__link">Usage</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/middleware/" class="subnavigation__link">Middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/error-handlers/" class="subnavigation__link">Error Handlers</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/creating-middleware/" class="subnavigation__link">Creating Middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/executing-middleware/" class="subnavigation__link">Executing and composing middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/api/" class="subnavigation__link">API Reference</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/migration/" class="subnavigation__link">Migration</a>
    </li>

                            
                        </ul>
                    </li>
                
            
        </ul>
    </div>

                </div>
            

            
            <div class="nav navbar-nav navbar-collapse visible-xs-block">
                <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
            </div>
        </div>
    </div>
</div>

    
    <header class="header">
    <div class="container">
        <div class="row">

            
            <div class="col-xs-8">
                <h1 class="header__title">
                    Documentation

                    
                        <small class="header__subtitle">zend-stratigility</small>
                    
                </h1>
            </div>

            
            <div class="col-xs-4 text-right">
                
                    <a href="#" class="header__link header__link--search" data-toggle="modal" data-target="#mkdocs_search_modal" title="Open search">
                        <i class="fa fa-search"></i> Search
                    </a>
                    <a href="https://github.com/zendframework/zend-stratigility/" class="header__link header__link--github" title="Go to repository of zend-stratigility">
                        <i class="fa fa-github"></i> GitHub
                    </a>
                
            </div>
        </div>
    </div>
</header>

    
    <div class="container">
        <div class="row">
            <div class="col-md-9 col-xs-12 content" role="main">
            <!-- content:begin -->
                
                    <ol class="breadcrumb" role="navigation" aria-label="breadcrumbs navigation">
    <li><a href="https://framework.zend.com/">Home</a></li>

    
        <li><a href="https://docs.zendframework.com/">Documentation</a></li>

        
            <li><a href="../..">zend-stratigility</a></li>

            
                
                    <li>v1</li>
                
            

            <li class="active">Creating Middleware</li>
        
    
</ol>


    
    

    
    
        <div class="toc">
            <h6 class="toc__headline">In This Article</h6>
            <ul class="toc__list">
                
                    <li class="toc__entry">
                        <a href="#legacy-error-middleware" class="toc__link">Legacy error middleware</a>
                    </li>
                
            </ul>
        </div>
    


    <h1 id="creating-middleware">Creating Middleware</h1>
<p>To create middleware, write a callable capable of receiving minimally PSR-7
ServerRequest and Response objects, and a callback to call the next middleware
in the chain. In your middleware, you can handle as much or as little of the
request as you want, including delegating to other middleware. By accepting the
third argument, <code>$next</code>, it can allow further processing via invoking that
argument, or return handling to the parent middleware by returning a response.</p>
<p>As an example, consider the following middleware which will use an external
router to map the incoming request path to a handler; if unable to map the
request, it returns processing to the next middleware.</p>
<pre class="codehilite"><code class="language-php">function ($req, $res, $next) use ($router) {
    $path = $req-&gt;getUri()-&gt;getPath();

    // Route the path
    $route = $router-&gt;route($path);
    if (! $route) {
        return $next($req, $res);
    }

    $handler = $route-&gt;getHandler();
    return $handler($req, $res, $next);
}</code></pre>

<p>Middleware written in this way can be any of the following:</p>
<ul>
<li>Closures (as shown above)</li>
<li>Functions</li>
<li>Static class methods</li>
<li>PHP array callbacks (e.g., <code>[ $dispatcher, 'dispatch' ]</code>, where <code>$dispatcher</code> is a class instance)</li>
<li>Invokable PHP objects (i.e., instances of classes implementing <code>__invoke()</code>)</li>
<li>Objects implementing <code>Zend\Stratigility\MiddlewareInterface</code> (including
  <code>Zend\Stratigility\MiddlewarePipe</code>)</li>
</ul>
<p>In all cases, if you wish to implement typehinting, the signature is:</p>
<pre class="codehilite"><code class="language-php">function (
    Psr\Http\Message\ServerRequestInterface $request,
    Psr\Http\Message\ResponseInterface $response,
    callable $next
) : Psr\Http\Message\ResponseInterface</code></pre>

<h3 id="legacy-error-middleware">Legacy error middleware</h3>
<ul>
<li>Deprecated since 1.3.0; to be removed in version 2.0.0. Please use the the
  <code>NotFoundHandler</code> and <code>ErrorHandler</code> detailed in the
  <a href="../error-handlers/">error handling chapter</a>, or equivalents.</li>
</ul>
<p>The implementation Stratigility offers also allows you to write specialized
error handler middleware. The signature is the same as for normal middleware,
except that it expects an additional argument prepended to the signature,
<code>$error</code>.  (Alternately, you can implement <code>Zend\Stratigility\ErrorMiddlewareInterface</code>.)
The signature is:</p>
<pre class="codehilite"><code class="language-php">function (
    $error, // Can be any type
    Psr\Http\Message\ServerRequestInterface $request,
    Psr\Http\Message\ResponseInterface $response,
    callable $next
) : Psr\Http\Message\ResponseInterface</code></pre>



    <nav>
    <ul class="page-nav hidden-print">

        
        <li class="page-nav__item">
            
                <a rel="prev" class="page-nav__link page-nav__link--prev" href="../error-handlers/">
                    <i class="fa fa-chevron-left"></i> Previous
                </a>
            
        </li>

        
        <li class="page-nav__item">
            
                <a rel="next" class="page-nav__link page-nav__link--next" href="../executing-middleware/">
                    Next <i class="fa fa-chevron-right"></i>
                </a>
            
        </li>
    </ul>
</nav>



    <div class="help-wanted">
        <p>
            Found a mistake or want to contribute to the documentation?
            <a href="https://github.com/zendframework/zend-stratigility/edit/master/docs/book/v1/creating-middleware.md" target="_blank" class="help-wanted__link">
                Edit this page on GitHub!
            </a>
        </p>
    </div>

                
            <!-- content:end -->
            </div>
            <div class="col-md-3 col-xs-12 sidebar">
                
                    <div class="component-selector">
    <h4 class="component-selector__title">Components</h4>
    <h5 class="component-selector__subtitle">Find documentation…</h5>
    <select class="form-control component-selector__control">
        <option value="/">Overview</option>
        <optgroup label="Components"></optgroup>
    </select>
</div>
                    
    <div class="subnavigation hidden-print">
        <h4 class="subnavigation__title">
            <a href="../..">zend-stratigility</a>
        </h4>

        <h5 class="subnavigation__subtitle">Table of Contents</h5>

        <ul class="subnavigation__list">
            
                
                    <li class="subnavigation__list-item ">
                        <a href="../../v3/intro/" class="subnavigation__link">Intro</a>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">Reference</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/install/" class="subnavigation__link">Installation and Requirements</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/usage/" class="subnavigation__link">Usage</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/middleware/" class="subnavigation__link">Middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/error-handlers/" class="subnavigation__link">Error Handlers</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/creating-middleware/" class="subnavigation__link">Creating Middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/executing-middleware/" class="subnavigation__link">Composing middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/api/" class="subnavigation__link">API Reference</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v3/migration/" class="subnavigation__link">Migration</a>
    </li>

                            
                        </ul>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">v1</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item ">
        <a href="../install/" class="subnavigation__link">Installation and Requirements</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../usage/" class="subnavigation__link">Usage</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../middleware/" class="subnavigation__link">Middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../error-handlers/" class="subnavigation__link">Error Handlers</a>
    </li>

                            
                                
    <li class="subnavigation__list-item subnavigation__list-item--active">
        <a href="./" class="subnavigation__link">Creating Middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../executing-middleware/" class="subnavigation__link">Executing and composing middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../api/" class="subnavigation__link">API Reference</a>
    </li>

                            
                        </ul>
                    </li>
                
            
                
                    <li class="subnavigation__list-item">
                        <span class="subnavigation__headline">v2</span>
                        <ul class="subnavigation__list">
                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/install/" class="subnavigation__link">Installation and Requirements</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/usage/" class="subnavigation__link">Usage</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/middleware/" class="subnavigation__link">Middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/error-handlers/" class="subnavigation__link">Error Handlers</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/creating-middleware/" class="subnavigation__link">Creating Middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/executing-middleware/" class="subnavigation__link">Executing and composing middleware</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/api/" class="subnavigation__link">API Reference</a>
    </li>

                            
                                
    <li class="subnavigation__list-item ">
        <a href="../../v2/migration/" class="subnavigation__link">Migration</a>
    </li>

                            
                        </ul>
                    </li>
                
            
        </ul>
    </div>

                
            </div>
        </div>
    </div>

    
    <footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-9">
                <h5>Zend Framework</h5>
                <ul>
                    <li><a href="https://framework.zend.com/">framework.zend.com</a></li>
                    <li><a href="https://docs.zendframework.com">docs.zendframework.com</a></li>
                    <li><a href="https://packages.zendframework.com">packages.zendframework.com</a></li>
                    <li><a href="https://apigility.org">apigility.org</a></li>
                    <li><a href="https://getexpressive.org/">getexpressive.org</a></li>
                </ul>
            </div>
        </div>

        
        <div class="row">
            <div class="col-md-12 text-center">
                <a class="footer__button" href="#page-top"><i class="fa fa-chevron-up" aria-hidden="true"></i></a>
            </div>
        </div>

        <div class="row">

            
            <div class="col-md-9">
                <h4 class="footer__headline">Copyright</h4>
                <p>&copy; 2006-2018 by <a href="https://www.zend.com/">Zend</a>, a <a href="https://www.roguewave.com/">Rogue Wave Company</a>.</p>
            </div>

            
            <div class="col-md-3">
                <h4 class="footer__headline">Support</h4>
                <ul class="support__list">
                    <li class="support__list-item">
                        <a href="https://discourse.zendframework.com" class="support__link" title="Forum"><i class="fa fa-comments"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://zendframework-slack.herokuapp.com" class="support__link" title="Chat"><i class="fa fa-slack"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://github.com/zendframework" class="support__link" title="Github"><i class="fa fa-github"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://twitter.com/zfdevteam" class="support__link" title="Twitter"><i class="fa fa-twitter"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://tinyletter.com/mwopzend" class="support__link" title="Newsletter"><i class="fa fa-envelope"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://framework.zend.com/blog/feed-rss.xml" class="support__link" title="Blog feed"><i class="fa fa-rss"></i></a>
                    </li>
                    <li class="support__list-item">
                        <a href="https://framework.zend.com/security/feed" class="support__link" title="Security feed"><i class="fa fa-rss-square"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</footer>

    <script>
        var base_url = '../..',
            siteName = 'zend-stratigility';
    </script>
    <script src="../../js/scripts-a978f1ec1a.js"></script>
        <script src="../../search/require.js"></script>
        <script src="../../search/search.js"></script>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>



</body>


</html>
